{
  "rules": {
    ".read": "true",
    ".write": "true",
    "users": {
      "$userId": {
        ".read": "(auth != null && auth.uid == $userId)",
        ".write": "(auth != null && auth.uid == $userId)"
      }
    },
    "posts": {
      "owner": {
        "userId": {
          "posts": {
            "$postId": {
              ".validate": "newData.isBoolean()",
              ".write": "((data.val() == null && (auth != null && auth.uid == userId)) || ((data.val() != null && newData.val() == null) && (auth != null && auth.uid == userId)))"
            }
          },
          "votes": {
            "$postId": {
              ".validate": "(newData.isString() && (newData.val() == 'up' || newData.val() == 'down'))",
              ".write": "((data.val() == null && (auth != null && auth.uid == userId)) || ((data.val() != null && newData.val() == null) && (auth != null && auth.uid == userId)))"
            }
          },
          ".read": "(auth != null && auth.uid == userId)"
        }
      },
      "data": {
        "posts": {
          "$postId": {
            ".validate": "(newData.hasChildren(['type', 'content', 'location', 'modified', 'created']) && newData.child('type').val() == 'text')",
            "type": {
              ".validate": "newData.isString()"
            },
            "content": {
              ".validate": "(newData.isString() && newData.val().length < 280)"
            },
            "location": {
              ".validate": "newData.isString()"
            },
            "$other": {
              ".validate": "false"
            },
            "modified": {
              ".validate": "(newData.isNumber() && newData.val() == now)"
            },
            "created": {
              ".validate": "(newData.isNumber() && newData.val() == (data.val() == null ? now : data.val()))"
            },
            ".write": "(data.val() == null && auth != null)"
          }
        },
        "votes": {
          "$postId": {
            ".validate": "newData.hasChildren(['up', 'down'])",
            "up": {
              ".validate": "newData.isNumber()"
            },
            "down": {
              ".validate": "newData.isNumber()"
            },
            "$other": {
              ".validate": "false"
            },
            ".write": "true"
          }
        },
        ".read": "auth != null"
      }
    }
  }
}
